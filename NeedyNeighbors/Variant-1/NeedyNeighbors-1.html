<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Needy Neighbors</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      color: white;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .header {
      display: flex;
      gap: 20px;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .timer {
      font-size: 1.5rem;
      font-weight: bold;
      background: rgba(255,255,255,0.1);
      padding: 8px 20px;
      border-radius: 10px;
      min-width: 80px;
      text-align: center;
    }
    .timer.warning { color: #ff6b6b; animation: pulse 0.5s infinite; }
    @keyframes pulse { 50% { opacity: 0.7; } }
    .difficulty-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    .diff-btn {
      padding: 10px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.2s;
    }
    .diff-btn.easy { background: #4ade80; color: #052e16; }
    .diff-btn.medium { background: #fbbf24; color: #451a03; }
    .diff-btn.hard { background: #f87171; color: #450a0a; }
    .diff-btn:hover { transform: scale(1.05); }
    .diff-btn.active { box-shadow: 0 0 0 3px white; }
    .game-container {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }
    .grid {
      display: grid;
      gap: 4px;
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 10px;
    }
    .cell {
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.08);
      border-radius: 8px;
      position: relative;
      transition: background 0.2s;
    }
    .cell.highlight {
      background: rgba(255,255,255,0.2);
    }
    .tile {
      position: absolute;
      width: 56px;
      height: 56px;
      border-radius: 6px;
      cursor: grab;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      user-select: none;
      transition: transform 0.1s, box-shadow 0.2s;
      z-index: 1;
      background: #2d3748;
      border: 2px solid #4a5568;
    }
    .tile:active, .tile.dragging {
      cursor: grabbing;
      transform: scale(1.1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      z-index: 100;
    }
    .tile-number {
      font-size: 1.4rem;
      font-weight: bold;
      color: white;
      text-shadow: 0 1px 3px rgba(0,0,0,0.3);
      z-index: 2;
    }
    .tile-bar-bg {
      position: absolute;
      bottom: 4px;
      left: 4px;
      right: 4px;
      height: 8px;
      background: rgba(0,0,0,0.4);
      border-radius: 4px;
      overflow: hidden;
    }
    .tile-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s, background 0.3s;
    }
    .tile.perfect {
      border-color: #22c55e;
      box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
    }
    .tile.overflow {
      border-color: #ef4444;
      box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
    }
    .controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.2s;
      background: #3b82f6;
      color: white;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(59, 130, 246, 0.4); }
    .btn.restart { background: #8b5cf6; }
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .overlay.show { opacity: 1; pointer-events: auto; }
    .overlay h2 { font-size: 3rem; margin-bottom: 20px; }
    .overlay.win h2 { color: #4ade80; }
    .overlay.lose h2 { color: #f87171; }
    .status {
      font-size: 1.1rem;
      color: rgba(255,255,255,0.7);
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>üß© Needy Neighbors</h1>
  
  <div class="difficulty-selector">
    <button class="diff-btn easy active" onclick="setDifficulty('easy')">Kolay</button>
    <button class="diff-btn medium" onclick="setDifficulty('medium')">Orta</button>
    <button class="diff-btn hard" onclick="setDifficulty('hard')">Zor</button>
  </div>
  
  <div class="header">
    <div class="timer" id="timer">60</div>
    <div class="status" id="status">0 / 0 ta≈ü yerle≈üti</div>
  </div>
  
  <div class="game-container">
    <div class="grid" id="grid"></div>
  </div>
  
  <div class="controls">
    <button class="btn restart" onclick="restartGame()">üîÑ Yeniden</button>
  </div>
  
  <div class="overlay" id="overlay">
    <h2 id="overlay-title">Kazandƒ±n!</h2>
    <p id="overlay-text" style="font-size:1.2rem;margin-bottom:20px;"></p>
    <button class="btn" onclick="restartGame()">Tekrar Oyna</button>
  </div>

<script>
const DIFFICULTIES = {
  easy: { grid: 4, tiles: 5, time: 60 },
  medium: { grid: 5, tiles: 9, time: 90 },
  hard: { grid: 6, tiles: 14, time: 120 }
};

let currentDifficulty = 'easy';
let gridSize, tileCount, timeLimit;
let grid, tiles, timerInterval, timeLeft;
let draggedTile = null;
let dragOffsetX, dragOffsetY;

function setDifficulty(diff) {
  currentDifficulty = diff;
  document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
  document.querySelector(`.diff-btn.${diff}`).classList.add('active');
  restartGame();
}

function generateSolvableLevel() {
  const config = DIFFICULTIES[currentDifficulty];
  gridSize = config.grid;
  tileCount = config.tiles;
  timeLimit = config.time;
  
  // √ñnce √ß√∂z√ºm√º olu≈ütur, sonra karƒ±≈ütƒ±r
  const solution = [];
  const cells = [];
  
  // T√ºm h√ºcreleri listele
  for (let y = 0; y < gridSize; y++) {
    for (let x = 0; x < gridSize; x++) {
      cells.push({ x, y });
    }
  }
  
  // Rastgele h√ºcreler se√ß
  const shuffled = cells.sort(() => Math.random() - 0.5);
  const selectedCells = shuffled.slice(0, tileCount);
  

  const tileData = [];
  selectedCells.forEach(cell => {
    let neighborCount = 0;
    for (let dy = -1; dy <= 1; dy++) {
      for (let dx = -1; dx <= 1; dx++) {
        if (dx === 0 && dy === 0) continue;
        const nx = cell.x + dx;
        const ny = cell.y + dy;
        if (selectedCells.some(c => c.x === nx && c.y === ny)) {
          neighborCount++;
        }
      }
    }
    tileData.push({
      targetX: cell.x,
      targetY: cell.y,
      target: neighborCount
    });
  });
  
  // Ta≈ülarƒ± rastgele pozisyonlara yerle≈ütir (karƒ±≈ütƒ±r)
  const allPositions = [];
  for (let y = 0; y < gridSize; y++) {
    for (let x = 0; x < gridSize; x++) {
      allPositions.push({ x, y });
    }
  }
  const randomPositions = allPositions.sort(() => Math.random() - 0.5).slice(0, tileCount);
  
  tiles = tileData.map((data, i) => ({
    id: i,
    x: randomPositions[i].x,
    y: randomPositions[i].y,
    target: data.target
  }));
  
  return tiles;
}

function createGrid() {
  const gridEl = document.getElementById('grid');
  gridEl.innerHTML = '';
  gridEl.style.gridTemplateColumns = `repeat(${gridSize}, 60px)`;
  
  grid = [];
  for (let y = 0; y < gridSize; y++) {
    grid[y] = [];
    for (let x = 0; x < gridSize; x++) {
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.x = x;
      cell.dataset.y = y;
      gridEl.appendChild(cell);
      grid[y][x] = { el: cell, tile: null };
    }
  }
  
  // Ta≈ülarƒ± yerle≈ütir
  tiles.forEach(tile => {
    const tileEl = document.createElement('div');
    tileEl.className = 'tile';
    tileEl.dataset.id = tile.id;
    tileEl.innerHTML = `
      <span class="tile-number">${tile.target}</span>
      <div class="tile-bar-bg"><div class="tile-bar-fill"></div></div>
    `;
    
    const cell = grid[tile.y][tile.x];
    cell.el.appendChild(tileEl);
    cell.tile = tile;
    tile.el = tileEl;
    
    // Drag events
    tileEl.addEventListener('mousedown', startDrag);
    tileEl.addEventListener('touchstart', startDrag, { passive: false });
  });
  
  updateAllTiles();
}

function startDrag(e) {
  e.preventDefault();
  const tileEl = e.target.closest('.tile');
  if (!tileEl) return;
  
  draggedTile = tiles.find(t => t.id === parseInt(tileEl.dataset.id));
  tileEl.classList.add('dragging');
  
  const rect = tileEl.getBoundingClientRect();
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
  
  dragOffsetX = clientX - rect.left;
  dragOffsetY = clientY - rect.top;
  
  // Ta≈üƒ± body'ye ta≈üƒ±
  document.body.appendChild(tileEl);
  tileEl.style.position = 'fixed';
  tileEl.style.left = (clientX - dragOffsetX) + 'px';
  tileEl.style.top = (clientY - dragOffsetY) + 'px';
  
  // Eski h√ºcreyi temizle
  grid[draggedTile.y][draggedTile.x].tile = null;
  
  document.addEventListener('mousemove', onDrag);
  document.addEventListener('mouseup', endDrag);
  document.addEventListener('touchmove', onDrag, { passive: false });
  document.addEventListener('touchend', endDrag);
}

function onDrag(e) {
  if (!draggedTile) return;
  e.preventDefault();
  
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
  
  draggedTile.el.style.left = (clientX - dragOffsetX) + 'px';
  draggedTile.el.style.top = (clientY - dragOffsetY) + 'px';
  
  // Highlight hedef h√ºcre
  document.querySelectorAll('.cell').forEach(c => c.classList.remove('highlight'));
  const targetCell = getCellAt(clientX, clientY);
  if (targetCell && !grid[targetCell.y][targetCell.x].tile) {
    grid[targetCell.y][targetCell.x].el.classList.add('highlight');
  }
}

function endDrag(e) {
  if (!draggedTile) return;
  
  const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
  const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
  
  document.querySelectorAll('.cell').forEach(c => c.classList.remove('highlight'));
  
  let targetCell = getCellAt(clientX, clientY);
  
  // Eƒüer hedef h√ºcre doluysa veya ge√ßersizse, eski pozisyona d√∂n
  if (!targetCell || grid[targetCell.y][targetCell.x].tile) {
    targetCell = { x: draggedTile.x, y: draggedTile.y };
  }
  
  // Ta≈üƒ± yeni h√ºcreye yerle≈ütir
  draggedTile.x = targetCell.x;
  draggedTile.y = targetCell.y;
  
  const cell = grid[targetCell.y][targetCell.x];
  cell.tile = draggedTile;
  
  draggedTile.el.style.position = 'absolute';
  draggedTile.el.style.left = '2px';
  draggedTile.el.style.top = '2px';
  draggedTile.el.classList.remove('dragging');
  cell.el.appendChild(draggedTile.el);
  
  draggedTile = null;
  
  document.removeEventListener('mousemove', onDrag);
  document.removeEventListener('mouseup', endDrag);
  document.removeEventListener('touchmove', onDrag);
  document.removeEventListener('touchend', endDrag);
  
  updateAllTiles();
  checkWin();
}

function getCellAt(clientX, clientY) {
  for (let y = 0; y < gridSize; y++) {
    for (let x = 0; x < gridSize; x++) {
      const rect = grid[y][x].el.getBoundingClientRect();
      if (clientX >= rect.left && clientX <= rect.right &&
          clientY >= rect.top && clientY <= rect.bottom) {
        return { x, y };
      }
    }
  }
  return null;
}

function countNeighbors(tile) {
  let count = 0;
  for (let dy = -1; dy <= 1; dy++) {
    for (let dx = -1; dx <= 1; dx++) {
      if (dx === 0 && dy === 0) continue;
      const nx = tile.x + dx;
      const ny = tile.y + dy;
      if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
        if (grid[ny][nx].tile) count++;
      }
    }
  }
  return count;
}

function updateAllTiles() {
  let perfectCount = 0;
  
  tiles.forEach(tile => {
    const neighbors = countNeighbors(tile);
    const ratio = Math.min(neighbors / tile.target, 1);
    const bar = tile.el.querySelector('.tile-bar-fill');
    
    bar.style.width = (ratio * 100) + '%';
    
    tile.el.classList.remove('perfect', 'overflow');
    
    if (neighbors === tile.target) {
      bar.style.background = '#22c55e';
      tile.el.classList.add('perfect');
      perfectCount++;
    } else if (neighbors > tile.target) {
      bar.style.background = '#ef4444';
      bar.style.width = '100%';
      tile.el.classList.add('overflow');
    } else {
      bar.style.background = '#4a7c59';
    }
  });
  
  document.getElementById('status').textContent = `${perfectCount} / ${tiles.length} ta≈ü yerle≈üti`;
}

function checkWin() {
  const allPerfect = tiles.every(tile => countNeighbors(tile) === tile.target);
  if (allPerfect) {
    clearInterval(timerInterval);
    showOverlay(true);
  }
}

function startTimer() {
  timeLeft = timeLimit;
  updateTimerDisplay();
  
  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();
    
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      showOverlay(false);
    }
  }, 1000);
}

function updateTimerDisplay() {
  const timerEl = document.getElementById('timer');
  timerEl.textContent = timeLeft;
  timerEl.classList.toggle('warning', timeLeft <= 10);
}

function showOverlay(win) {
  const overlay = document.getElementById('overlay');
  const title = document.getElementById('overlay-title');
  const text = document.getElementById('overlay-text');
  
  overlay.className = 'overlay show ' + (win ? 'win' : 'lose');
  title.textContent = win ? 'üéâ Kazandƒ±n!' : '‚è∞ S√ºre Doldu!';
  text.textContent = win ? `${timeLeft} saniye kaldƒ±!` : 'Tekrar dene!';
}

function restartGame() {
  clearInterval(timerInterval);
  document.getElementById('overlay').classList.remove('show');
  
  generateSolvableLevel();
  createGrid();
  startTimer();
}

// Ba≈ülat
restartGame();
</script>
</body>
</html>
